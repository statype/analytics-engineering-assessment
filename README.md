# Analytics Engineering Technical Assessment

<!--
autogenerated ToC from the Markdown All in One VSCode Extension:
https://marketplace.visualstudio.com/items?itemName=yzhang.markdown-all-in-one
-->
* [Analytics Engineering Technical Assessment](#analytics-engineering-technical-assessment)
  * [Overview](#overview)
  * [The Assignment](#the-assignment)
    * [Additional smaller tasks](#additional-smaller-tasks)
    * [Submitting the Assignment](#submitting-the-assignment)
  * [Getting Started](#getting-started)
    * [Get the assignment](#get-the-assignment)
    * [Setting up your computer](#setting-up-your-computer)

## Overview

This repository contains a skeleton [`dbt`](https://getdbt.com) project to which
we would like you, an Analytics Engineering Candidate, to make some
improvements.  The goal of this assessment is not to produce a perfect or
polished result but to show what you can do and figure out in a short time table
so that we might iterate on it together in the next stage.

If you are unfamiliar with `dbt` you should still be able to complete the
assignment, albeit with a bit more research and reading of documentation.
That's great!  Keep notes and we can talk about your research later.  In the
mean time competency in SQL and the examples in the `models/` directory should
allow you to make progress even without `dbt` experience.

## The Assignment

We will either pair for about 2hours, or if you've arranged it, work
asynchronously for 2-3h. If you are working on your own asynchronously, please
take 2-3h to complete the following tasks. 3 hours is an absolute maximum.  We
would rather an unpolished working solution after 2 hours than an incredibly
polished and "perfect" solution after 10.

The model defined in `marts/customers/customer_counts_daily.sql` counts the
total number of customer records created over time as a metric (timeseries).
This *may* be a vanity metric a company might track e.g. "We have had N
customers signup since we launched!"  This does *not* calculate the more
meaningful metric of "how many active customers do we have on day Y?" which is
good for tracking engagement and for reasoning about revenue.

We would like you to build two models: Active Customers by Day and Churn by Day
as both a raw number of churned customers and a percentage of active customers
on that day.  On your way to so doing please feel free to refactor or change our
staging or models in marts.

If working asynchronously please describe your Churn model, its assumptions and
pros and cons in a few sentences.  Submit your answers in markdown format in a
file called `churn.md`

### Additional smaller tasks

During your work you may notice that there is little in the way of testing or
documentation captured in this project.  These are not a replacement for solving
the core assignments of finding Active Customers by Day and Churn by Day but
should you find that you have some remaining time or that addressing the below
help you acheive the main goals we encourage you to do one or more of the
following (or others we have not addressed - simply describe them in detail in
your solution).

- [ ] Add [Documentation](https://docs.getdbt.com/docs/building-a-dbt-project/documentation) to Sources and/or
      Models or more sophisticated documentation with ["doc blocks"](https://docs.getdbt.com/docs/building-a-dbt-project/documentation#using-docs-blocks)
- [ ] Add [Generic Tests](https://docs.getdbt.com/docs/building-a-dbt-project/tests#generic-tests) to our models.
- [ ] Add one or more [Singular Tests](https://docs.getdbt.com/docs/building-a-dbt-project/tests#singular-tests)
      to one or more of our models.
- [ ] Ensure the Linter passes for your code by running `make lint` from the `acme-corp/` directory.

### Submitting the Assignment

Please feel comfortable working on the `main` branch in this repository.  You
may absolutely branch to isolate work on ideas or approaches but merge your
completed solutions to `main`.

If we are pairing please commit and push any changes to your copy of the code.
This will allow us to go back and talk concretely about the code during any
internal followup conversations.  If you are working alone, please let us know
when you are done, we will grade it and talk about it during our followup
iteration session.

## Getting Started

### Get the assignment

1. This repository is a template repository. Please use the *`Use this template`*
to create a new *Private* repository in your personal GitHub account:
<img src="./docs/artifacts/use_this_template.png" width="800px" height="246px" alt="Arrow pointing to the 'Use this template' button.">

2. On the next screen please select these options:
<img src="./docs/artifacts/create_new_private_repository.png" width="800px" height="617px" alt="Image indicating the use of a clear name, selecting Private as the repository visibility, and an arrow to 'Create repository from template'">

3. Add your Statype contact as an external contributor - they should have
  provided their Github Username but if they forgot please just ask:
<img src="./docs/artifacts/add_collaborator_to_private_repo.png" width="800px" height="500px" alt="Check that you have a private repository by looking for the lock button.  Click settings, then Collaborators, then 'Add people'.">

### Setting up your computer

We have some technical opinions on the environment you should use to complete
this work.  This is the same set of tools we use all day at Statype to be
effective as a group.  Our choices are _intended_ to make completing the
assignment as smooth as possible but sometimes there are hiccups.  Before you
start the assignment proper please ensure that you are able to get to `dbt run`
below.  If you are not let us know and we will help you get setup before you get
to work.  Please do not struggle without asking for help.

*Prerequisites*:

- Ensure you have [VSCode](https://code.visualstudio.com/download) installed locally.
- Ensure you have [Docker](https://docs.docker.com/get-docker/) installed locally.

When you open this repository in VSCode you should be prompted to re-open the
project in a container.  Once the devcontainer is running, a Postgres container
will be running , python will be installed, and `dbt` and `sqlfluff` (a
configured SQL linter) will be ready to go.

The database should be pre-loaded with data meaning that if you run
`workspace/acme-corp$ dbt run` (`dbt run` from the `/workspace/acme-corp`
directory) you should not get any errors.  If you do please run `dbt debug` from
the same directory - it should say "All checks passed!" - if not please let us
know.

There are two sets of helper commands in the form of "make targets" e.g.
commands of the form `make <target>` available from two different directories:

- `/workspace` has commands to setup, and reset your database if things aren't
  working.
- `/workspace/acme-corp` has commands to run and test `dbt` models as well as
  lint (check) them for style.

In either directory running `make help` will give you a list of available
commands.

When running `/workspace/acme-corp$ dbt run`, if you get errors which resemble
the following this indicates the database is not setup correctly.  Running
`/workspace$ make reset-source-db` should fix the database for you.

```txt
Database Error in model stg_customers (models/staging/acme/stg_customers.sql)
  relation "acme.customers" does not exist
  LINE 13:     from "postgres"."acme"."customers"
                    ^
  compiled SQL at target/run/acme_corp/models/staging/acme/stg_customers.sql
```

Additionally, when `dbt` runs the results will reside in a Postgres instance
running in the devcontainer.  You *can* access them using the Postgres CLI from
within the devcontainer but we recommend connecting with the client of your
choice from your computer (rather than from within the devcontainer).  We like
[Beekeeper Studio](https://www.beekeeperstudio.io/) which should be able to
connect to the Postgres on `localhost` on port `5432`.

If you have any difficulties with the above please reach out to us and we will
do our best to unstick you.
